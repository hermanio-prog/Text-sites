    <!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Completo de Escola de Condução - Macau</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f7ff;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px 0;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin-bottom: 30px;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .main-menu {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .menu-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            border-left: 5px solid #2a5298;
        }
        
        .menu-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .menu-card i {
            font-size: 3rem;
            color: #2a5298;
            margin-bottom: 15px;
        }
        
        .menu-card h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #1e3c72;
        }
        
        .menu-card p {
            color: #666;
            margin-bottom: 15px;
        }
        
        .status-bar {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .progress-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .progress-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(#4CAF50 0% 75%, #eee 75% 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .progress-circle::before {
            content: '';
            position: absolute;
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 50%;
        }
        
        .progress-circle span {
            position: relative;
            font-weight: bold;
            font-size: 1.2rem;
            color: #1e3c72;
        }
        
        .game-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            min-height: 500px;
            display: none;
        }
        
        .game-content.active {
            display: block;
        }
        
        .quiz-question {
            font-size: 1.3rem;
            margin-bottom: 25px;
            color: #1e3c72;
            font-weight: 600;
            line-height: 1.5;
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .quiz-option {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: flex-start;
        }
        
        .quiz-option:hover {
            background-color: #f5f9ff;
        }
        
        .quiz-option.selected {
            border-color: #2a5298;
            background-color: #e8efff;
        }
        
        .quiz-option.correct {
            border-color: #4CAF50;
            background-color: #e8f5e9;
        }
        
        .quiz-option.wrong {
            border-color: #f44336;
            background-color: #ffebee;
        }
        
        .option-letter {
            display: inline-block;
            width: 30px;
            height: 30px;
            background-color: #2a5298;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 15px;
            flex-shrink: 0;
            font-weight: bold;
        }
        
        .quiz-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #2a5298;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1e3c72;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .btn-success {
            background-color: #4CAF50;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #388e3c;
        }
        
        .signal-game {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }
        
        .signal-display {
            width: 200px;
            height: 200px;
            background-color: #f8f9fa;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            color: #1e3c72;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .signal-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
            max-width: 600px;
        }
        
        .signal-option {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .signal-option:hover {
            background-color: #e8efff;
        }
        
        .parking-game {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .parking-area {
            width: 100%;
            height: 400px;
            background-color: #e0e0e0;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
            border: 3px solid #333;
        }
        
        .car {
            width: 60px;
            height: 100px;
            background-color: #ff5722;
            position: absolute;
            border-radius: 5px;
            transition: all 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .parking-spot {
            position: absolute;
            border: 2px dashed #333;
            background-color: rgba(255, 255, 255, 0.7);
        }
        
        .car-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .car-controls .btn {
            min-width: 100px;
        }
        
        .result-message {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2rem;
            margin: 20px 0;
            display: none;
        }
        
        .result-message.success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4CAF50;
            display: block;
        }
        
        .result-message.error {
            background-color: #ffebee;
            color: #c62828;
            border: 2px solid #f44336;
            display: block;
        }
        
        .result-message.info {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 2px solid #2196f3;
            display: block;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .back-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #2a5298;
            cursor: pointer;
        }
        
        .game-stats {
            display: flex;
            gap: 20px;
            color: #666;
        }
        
        .category-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .category-btn {
            padding: 8px 16px;
            background-color: #e8efff;
            border: 2px solid #2a5298;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .category-btn.active {
            background-color: #2a5298;
            color: white;
        }
        
        .category-btn:hover {
            background-color: #d0dbf9;
        }
        
        .exam-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #2a5298;
        }
        
        .exam-info h3 {
            color: #1e3c72;
            margin-bottom: 10px;
        }
        
        .exam-info p {
            margin-bottom: 5px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }
        
        .question-counter {
            background-color: #e8efff;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: #1e3c72;
        }
        
        .score-display {
            background-color: #e8f5e9;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: #2e7d32;
        }
        
        .timer {
            background-color: #fff3cd;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: #856404;
        }
        
        .signal-category-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .signal-category-btn {
            padding: 8px 16px;
            background-color: #e8efff;
            border: 2px solid #2a5298;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .signal-category-btn.active {
            background-color: #2a5298;
            color: white;
        }
        
        .signal-image {
            max-width: 150px;
            max-height: 150px;
            margin: 20px 0;
        }
        
        .priority-scenario {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .priority-image {
            max-width: 300px;
            margin: 20px auto;
            display: block;
            border: 2px solid #ddd;
            border-radius: 10px;
        }
        
        @media (max-width: 768px) {
            .main-menu {
                grid-template-columns: 1fr;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .game-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .game-stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .quiz-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .quiz-controls .btn {
                width: 100%;
            }
            
            .signal-options {
                grid-template-columns: 1fr;
            }
            
            .car-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .car-controls .btn {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fas fa-car"></i> Simulador Completo de Escola de Condução</h1>
            <p>Prepare-se para o exame teórico e prático com todas as funcionalidades em um só jogo!</p>
        </div>
    </header>
    
    <div class="container">
        <div class="status-bar">
            <div>
                <h2>Bem-vindo ao Simulador Completo</h2>
                <p>Treine todas as áreas necessárias para passar no exame de condução</p>
            </div>
            
            <div class="progress-section">
                <div class="progress-circle">
                    <span id="progressPercentage">0%</span>
                </div>
                <div>
                    <h3>Progresso Geral</h3>
                    <p id="progressText">0 de 4 módulos completados</p>
                </div>
            </div>
        </div>
        
        <div class="game-container">
            <div class="main-menu" id="mainMenu">
                <div class="menu-card" data-game="quiz">
                    <i class="fas fa-question-circle"></i>
                    <h3>Quiz Teórico Completo</h3>
                    <p>150 questões oficiais do Grupo C - Regras de Trânsito de Macau</p>
                    <span class="btn btn-primary">Iniciar Quiz</span>
                </div>
                
                <div class="menu-card" data-game="signals">
                    <i class="fas fa-traffic-light"></i>
                    <h3>Reconhecimento de Sinais</h3>
                    <p>Aprenda a identificar todos os sinais de trânsito e seu significado</p>
                    <span class="btn btn-primary">Treinar Sinais</span>
                </div>
                
                <div class="menu-card" data-game="parking">
                    <i class="fas fa-parking"></i>
                    <h3>Estacionamento Virtual</h3>
                    <p>Pratique suas habilidades de manobra e estacionamento</p>
                    <span class="btn btn-primary">Praticar</span>
                </div>
                
                <div class="menu-card" data-game="priority">
                    <i class="fas fa-exchange-alt"></i>
                    <h3>Prioridades no Trânsito</h3>
                    <p>Aprenda a identificar quem tem prioridade em diferentes situações</p>
                    <span class="btn btn-primary">Treinar</span>
                </div>
            </div>
            
            <!-- Quiz Teórico -->
            <div class="game-content" id="quizGame">
                <div class="game-header">
                    <button class="back-btn" id="backFromQuiz"><i class="fas fa-arrow-left"></i> Voltar</button>
                    <div>
                        <h2>Quiz Teórico - Regras de Trânsito</h2>
                        <div class="game-stats">
                            <span class="score-display"><i class="fas fa-check-circle"></i> Acertos: <span id="quizScore">0</span></span>
                            <span class="question-counter"><i class="fas fa-question-circle"></i> Questão: <span id="quizQuestionNum">1</span>/<span id="quizTotalQuestions">0</span></span>
                        </div>
                    </div>
                </div>
                
                <div class="category-selector" id="categorySelector">
                    <!-- Categorias serão carregadas via JavaScript -->
                </div>
                
                <div class="quiz-question" id="quizQuestion">
                    Carregando questão...
                </div>
                
                <div class="quiz-options" id="quizOptions">
                    <!-- As opções serão carregadas via JavaScript -->
                </div>
                
                <div class="result-message" id="quizResult"></div>
                
                <div class="quiz-controls">
                    <button class="btn btn-secondary" id="quizHint">Explicação</button>
                    <button class="btn btn-primary" id="quizSubmit" disabled>Confirmar Resposta</button>
                    <button class="btn btn-success" id="quizNext" style="display: none;">Próxima Questão</button>
                </div>
            </div>
            
            <!-- Reconhecimento de Sinais -->
            <div class="game-content" id="signalsGame">
                <div class="game-header">
                    <button class="back-btn" id="backFromSignals"><i class="fas fa-arrow-left"></i> Voltar</button>
                    <div>
                        <h2>Reconhecimento de Sinais de Trânsito</h2>
                        <div class="game-stats">
                            <span class="score-display"><i class="fas fa-check-circle"></i> Acertos: <span id="signalsScore">0</span></span>
                            <span class="question-counter"><i class="fas fa-traffic-light"></i> Sinal: <span id="signalNum">1</span>/<span id="signalsTotal">0</span></span>
                        </div>
                    </div>
                </div>
                
                <div class="signal-category-selector" id="signalCategorySelector">
                    <!-- Categorias de sinais serão carregadas via JavaScript -->
                </div>
                
                <div class="signal-game">
                    <div class="signal-display" id="signalDisplay">
                        <i class="fas fa-traffic-light"></i>
                    </div>
                    
                    <div class="quiz-question" id="signalQuestion">
                        O que significa este sinal de trânsito?
                    </div>
                    
                    <div class="signal-options" id="signalOptions">
                        <!-- As opções serão carregadas via JavaScript -->
                    </div>
                    
                    <div class="result-message" id="signalResult"></div>
                    
                    <div class="quiz-controls">
                        <button class="btn btn-primary" id="signalSubmit" disabled>Confirmar Resposta</button>
                        <button class="btn btn-success" id="signalNext" style="display: none;">Próximo Sinal</button>
                    </div>
                </div>
            </div>
            
            <!-- Estacionamento -->
            <div class="game-content" id="parkingGame">
                <div class="game-header">
                    <button class="back-btn" id="backFromParking"><i class="fas fa-arrow-left"></i> Voltar</button>
                    <div>
                        <h2>Estacionamento Virtual</h2>
                        <div class="game-stats">
                            <span><i class="fas fa-car"></i> Manobras: <span id="parkingMoves">0</span></span>
                            <span><i class="fas fa-flag-checkered"></i> Objetivo: Estacionar o carro</span>
                        </div>
                    </div>
                </div>
                
                <div class="parking-game">
                    <div class="parking-area" id="parkingArea">
                        <!-- Carro e vagas serão adicionadas via JavaScript -->
                    </div>
                    
                    <div class="car-controls">
                        <button class="btn btn-secondary" id="carLeft"><i class="fas fa-arrow-left"></i> Esquerda</button>
                        <button class="btn btn-secondary" id="carRight"><i class="fas fa-arrow-right"></i> Direita</button>
                        <button class="btn btn-secondary" id="carUp"><i class="fas fa-arrow-up"></i> Frente</button>
                        <button class="btn btn-secondary" id="carDown"><i class="fas fa-arrow-down"></i> Trás</button>
                        <button class="btn btn-primary" id="carRotate"><i class="fas fa-redo"></i> Girar</button>
                        <button class="btn btn-success" id="parkCar">Estacionar</button>
                        <button class="btn btn-secondary" id="resetParking">Reiniciar</button>
                    </div>
                    
                    <div class="result-message" id="parkingResult"></div>
                    
                    <div class="quiz-controls">
                        <button class="btn btn-primary" id="parkingHint">Dica de Estacionamento</button>
                    </div>
                </div>
            </div>
            
            <!-- Prioridades no Trânsito -->
            <div class="game-content" id="priorityGame">
                <div class="game-header">
                    <button class="back-btn" id="backFromPriority"><i class="fas fa-arrow-left"></i> Voltar</button>
                    <div>
                        <h2>Prioridades no Trânsito</h2>
                        <div class="game-stats">
                            <span class="score-display"><i class="fas fa-check-circle"></i> Acertos: <span id="priorityScore">0</span></span>
                            <span class="question-counter"><i class="fas fa-crosshairs"></i> Cenário: <span id="priorityNum">1</span>/<span id="priorityTotal">0</span></span>
                        </div>
                    </div>
                </div>
                
                <div class="priority-scenario" id="priorityScenario">
                    <!-- O cenário será carregado via JavaScript -->
                </div>
                
                <div class="quiz-question" id="priorityQuestion">
                    Carregando cenário...
                </div>
                
                <div class="quiz-options" id="priorityOptions">
                    <!-- As opções serão carregadas via JavaScript -->
                </div>
                
                <div class="result-message" id="priorityResult"></div>
                
                <div class="quiz-controls">
                    <button class="btn btn-primary" id="prioritySubmit" disabled>Confirmar Resposta</button>
                    <button class="btn btn-success" id="priorityNext" style="display: none;">Próximo Cenário</button>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>Simulador Completo de Escola de Condução &copy; 2023 - Desenvolvido para ajudar futuros condutores</p>
            <p>Baseado no material oficial da Direcção dos Serviços para os Assuntos de Tráfego de Macau</p>
        </div>
    </footer>

    <script>
        // ==============================
        // DADOS COMPLETOS DO JOGO
        // ==============================

        // Questões do Quiz Teórico (30 primeiras de exemplo)
        const allQuestions = [
            // Questões 1-20: Definições Gerais
            {
                id: 1,
                question: "O que entende por via pública?",
                options: [
                    "Via de comunicação terrestre aberta ao trânsito público.",
                    "Via de comunicação aberta ao trânsito de peões.",
                    "Parte da via pública especialmente destinada ao trânsito de veículos.",
                    "Via de comunicação destinada especialmente ao trânsito de veículos de transporte de passageiros públicos."
                ],
                correct: 0,
                category: "Definições Gerais",
                explanation: "Via pública é qualquer via de comunicação terrestre aberta ao trânsito público."
            },
            {
                id: 2,
                question: "O que entende por via rápida?",
                options: [
                    "Via pública sem restrição de velocidade máxima.",
                    "Via pública sem restrição de velocidade.",
                    "Via pública na qual a velocidade máxima permitida excede os limites máximos genéricos previstos.",
                    "Via pública apenas com restrição de velocidade máxima."
                ],
                correct: 2,
                category: "Definições Gerais",
                explanation: "Via rápida é uma via pública onde a velocidade máxima permitida excede os limites máximos genéricos."
            },
            {
                id: 3,
                question: "O que entende por auto-estrada?",
                options: [
                    "Via pública sem restrição de velocidade máxima.",
                    "Via pública destinada a trânsito rápido, com separação física das faixas de rodagem, com acessos condicionados, e sinalizada como tal.",
                    "Via pública destinada a trânsito rápido, sem separação física das faixas de rodagem, com acessos condicionados, e sinalizada como tal.",
                    "Via pública em que o veículo pode circular a qualquer velocidade."
                ],
                correct: 1,
                category: "Definições Gerais",
                explanation: "Auto-estrada é uma via pública especialmente destinada a trânsito rápido, com separação física das faixas de rodagem."
            },
            // ... (adicionar mais 27 questões seguindo o mesmo padrão)
            {
                id: 30,
                question: "Semi-reboque:",
                options: [
                    "Veículo a motor que pode atrelar veículos.",
                    "Veículo destinado a transitar atrelado a um veículo a motor.",
                    "Veículo destinado a transitar atrelado a um veículo a motor, assentando a parte da frente e distribuindo o peso sobre este.",
                    "Veículo que necessita de ser transportado por um outro veículo a motor."
                ],
                correct: 2,
                category: "Definições de Veículos",
                explanation: "Semi-reboque é um veículo destinado a transitar atrelado a um veículo a motor, assentando a parte da frente e distribuindo o peso sobre este."
            }
        ];

        // Sinais de Trânsito
        const trafficSigns = {
            "Perigo": [
                {
                    name: "Curva perigosa à direita",
                    icon: "fas fa-arrow-right",
                    color: "#ff9800",
                    question: "O que indica este sinal?",
                    options: [
                        "Curva perigosa à esquerda",
                        "Curva perigosa à direita",
                        "Intersecção com prioridade",
                        "Passagem de nível"
                    ],
                    correct: 1,
                    explanation: "Este sinal triangular com borda vermelha indica uma curva perigosa à direita. Deve reduzir a velocidade e ter cuidado."
                },
                {
                    name: "Passagem de nível com barreiras",
                    icon: "fas fa-train",
                    color: "#ff9800",
                    question: "O que significa este sinal?",
                    options: [
                        "Passagem de nível sem barreiras",
                        "Passagem de nível com barreiras",
                        "Cruzamento com linha férrea",
                        "Aproximação de estação de comboio"
                    ],
                    correct: 1,
                    explanation: "Este sinal indica a proximidade de uma passagem de nível com barreiras. Deve reduzir a velocidade e estar preparado para parar."
                }
            ],
            "Proibição": [
                {
                    name: "Sentido proibido",
                    icon: "fas fa-ban",
                    color: "#f44336",
                    question: "O que indica este sinal circular vermelho?",
                    options: [
                        "Proibido estacionar",
                        "Sentido proibido",
                        "Proibido ultrapassar",
                        "Velocidade mínima"
                    ],
                    correct: 1,
                    explanation: "Este sinal indica sentido proibido. Não pode entrar na via onde este sinal está colocado."
                },
                {
                    name: "Proibido estacionar",
                    icon: "fas fa-parking",
                    color: "#f44336",
                    question: "Quando é permitido estacionar com este sinal?",
                    options: [
                        "Nunca é permitido estacionar",
                        "É permitido estacionar à noite",
                        "É permitido estacionar por 5 minutos",
                        "É permitido parar para embarque/desembarque"
                    ],
                    correct: 3,
                    explanation: "Este sinal (E1) indica proibição de estacionar, mas permite paragem para embarque/desembarque rápido de passageiros."
                }
            ],
            "Obrigação": [
                {
                    name: "Obrigação de seguir em frente",
                    icon: "fas fa-arrow-up",
                    color: "#2196f3",
                    question: "O que significa este sinal azul com seta branca?",
                    options: [
                        "Obrigação de seguir em frente",
                        "Sentido único",
                        "Paragem obrigatória",
                        "Proibido virar à direita"
                    ],
                    correct: 0,
                    explanation: "Este sinal indica obrigação de seguir em frente. Não pode virar à esquerda ou à direita."
                },
                {
                    name: "Velocidade mínima obrigatória",
                    icon: "fas fa-tachometer-alt",
                    color: "#2196f3",
                    question: "O que indica este sinal azul com número branco?",
                    options: [
                        "Velocidade máxima permitida",
                        "Velocidade mínima obrigatória",
                        "Velocidade recomendada",
                        "Fim de velocidade mínima"
                    ],
                    correct: 1,
                    explanation: "Este sinal indica a velocidade mínima obrigatória. Não pode circular a velocidade inferior à indicada."
                }
            ],
            "Indicação": [
                {
                    name: "Passagem para peões",
                    icon: "fas fa-person-walking",
                    color: "#4caf50",
                    question: "O que indica este sinal?",
                    options: [
                        "Passagem para peões",
                        "Proibido a peões",
                        "Área residencial",
                        "Ciclistas na via"
                    ],
                    correct: 0,
                    explanation: "Este sinal indica passagem para peões. Deve reduzir a velocidade e ceder passagem aos peões."
                },
                {
                    name: "Pista para ciclistas",
                    icon: "fas fa-bicycle",
                    color: "#2196f3",
                    question: "O que significa este sinal?",
                    options: [
                        "Pista para ciclistas",
                        "Proibido a ciclistas",
                        "Ciclistas a atravessar",
                        "Estacionamento de bicicletas"
                    ],
                    correct: 0,
                    explanation: "Este sinal indica pista ou via reservada para ciclistas."
                }
            ]
        };

        // Cenários de Prioridades
        const priorityScenarios = [
            {
                scenario: "Cruzamento sem sinalização",
                description: "Dois veículos aproximam-se de um cruzamento sem qualquer sinalização.",
                question: "Quem tem prioridade neste cruzamento?",
                options: [
                    "O veículo que chegar primeiro ao cruzamento",
                    "O veículo que vem pela direita",
                    "O veículo maior",
                    "O veículo mais rápido"
                ],
                correct: 1,
                explanation: "Em cruzamentos sem sinalização, aplica-se a regra geral da prioridade à direita."
            },
            {
                scenario: "Rotunda",
                description: "Um veículo quer entrar numa rotunda enquanto outro já circula nela.",
                question: "Numa rotunda, qual a prioridade correta?",
                options: [
                    "Os veículos que já estão na rotunda têm prioridade",
                    "Os veículos que vão entrar na rotunda têm prioridade",
                    "O veículo maior tem sempre prioridade",
                    "O veículo mais rápido tem prioridade"
                ],
                correct: 0,
                explanation: "Na rotunda, os veículos que já estão circulando têm prioridade sobre os que pretendem entrar."
            },
            {
                scenario: "Saída de propriedade privada",
                description: "Um veículo sai de um parque de estacionamento para a via pública.",
                question: "Ao sair de um parque de estacionamento para a via pública, quem tem prioridade?",
                options: [
                    "Os veículos na via pública",
                    "O veículo que sai do parque",
                    "O veículo que buzinar primeiro",
                    "Depende da hora do dia"
                ],
                correct: 0,
                explanation: "Ao sair de uma propriedade privada para a via pública, deve dar prioridade a todos os veículos na via pública."
            },
            {
                scenario: "Veículo de emergência",
                description: "Uma ambulância aproxima-se com sinais luminosos e sonoros ativos.",
                question: "Quando um veículo de emergência se aproxima com sinais luminosos e sonoros, o que deve fazer?",
                options: [
                    "Ceder passagem imediatamente, desviando-se se necessário",
                    "Manter a posição e velocidade",
                    "Acelerar para sair rapidamente do caminho",
                    "Parar imediatamente no meio da via"
                ],
                correct: 0,
                explanation: "Deve ceder passagem imediatamente aos veículos de emergência, desviando-se para a direita se possível."
            },
            {
                scenario: "Via com inclinação",
                description: "Dois veículos encontram-se numa via de forte inclinação.",
                question: "Em termos gerais, nas vias de forte inclinação:",
                options: [
                    "Deve ceder a passagem ao condutor do veículo que sobe",
                    "Deve ceder a passagem ao condutor do veículo que desce",
                    "Deve ceder a passagem ao condutor do veículo que sobe e desce",
                    "Não deve ceder a passagem"
                ],
                correct: 0,
                explanation: "Nas vias com inclinação acentuada, o veículo que desce deve ceder passagem ao que sobe."
            }
        ];

        // ==============================
        // ESTADO DO JOGO
        // ==============================
        const gameState = {
            currentGame: null,
            selectedOption: null,
            // Quiz
            quiz: {
                currentQuestion: 0,
                score: 0,
                currentCategory: "Todas",
                questions: [],
                currentSignalsCategory: "Todos"
            },
            // Sinais
            signals: {
                currentSignal: 0,
                score: 0,
                currentCategory: "Todos",
                signs: []
            },
            // Prioridades
            priority: {
                currentScenario: 0,
                score: 0,
                scenarios: [...priorityScenarios]
            },
            // Estacionamento
            parking: {
                moves: 0,
                carRotation: 0,
                carPosition: { x: 50, y: 50 },
                completed: false
            },
            // Progresso geral
            progress: {
                quizCompleted: false,
                signalsCompleted: false,
                parkingCompleted: false,
                priorityCompleted: false
            }
        };

        // ==============================
        // INICIALIZAÇÃO DO JOGO
        // ==============================
        function initGame() {
            // Configurar menu principal
            document.querySelectorAll('.menu-card').forEach(card => {
                card.addEventListener('click', function() {
                    const game = this.getAttribute('data-game');
                    startGame(game);
                });
            });

            // Configurar botões de voltar
            document.getElementById('backFromQuiz').addEventListener('click', () => showMainMenu());
            document.getElementById('backFromSignals').addEventListener('click', () => showMainMenu());
            document.getElementById('backFromParking').addEventListener('click', () => showMainMenu());
            document.getElementById('backFromPriority').addEventListener('click', () => showMainMenu());

            // Inicializar módulos
            initQuiz();
            initSignals();
            initParking();
            initPriority();
            
            updateProgress();
        }

        // ==============================
        // FUNÇÕES GERAIS DO JOGO
        // ==============================
        function startGame(game) {
            gameState.currentGame = game;
            document.getElementById('mainMenu').style.display = 'none';
            
            // Esconder todos os jogos
            document.querySelectorAll('.game-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Mostrar o jogo selecionado
            switch(game) {
                case 'quiz':
                    startQuiz();
                    document.getElementById('quizGame').classList.add('active');
                    break;
                case 'signals':
                    startSignals();
                    document.getElementById('signalsGame').classList.add('active');
                    break;
                case 'parking':
                    startParking();
                    document.getElementById('parkingGame').classList.add('active');
                    break;
                case 'priority':
                    startPriority();
                    document.getElementById('priorityGame').classList.add('active');
                    break;
            }
        }

        function showMainMenu() {
            gameState.currentGame = null;
            document.querySelectorAll('.game-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById('mainMenu').style.display = 'grid';
            updateProgress();
        }

        function updateProgress() {
            let completedCount = 0;
            if (gameState.progress.quizCompleted) completedCount++;
            if (gameState.progress.signalsCompleted) completedCount++;
            if (gameState.progress.parkingCompleted) completedCount++;
            if (gameState.progress.priorityCompleted) completedCount++;
            
            const percentage = Math.round((completedCount / 4) * 100);
            document.getElementById('progressPercentage').textContent = `${percentage}%`;
            document.getElementById('progressText').textContent = `${completedCount} de 4 módulos completados`;
            
            // Atualizar círculo de progresso
            const progressCircle = document.querySelector('.progress-circle');
            progressCircle.style.background = `conic-gradient(#4CAF50 0% ${percentage}%, #eee ${percentage}% 100%)`;
        }

        // ==============================
        // MÓDULO: QUIZ TEÓRICO
        // ==============================
        function initQuiz() {
            // Configurar controles
            document.getElementById('quizSubmit').addEventListener('click', submitQuizAnswer);
            document.getElementById('quizNext').addEventListener('click', nextQuizQuestion);
            document.getElementById('quizHint').addEventListener('click', showQuizExplanation);
            
            // Inicializar categorias
            const categories = ["Todas", "Definições Gerais", "Definições de Veículos", "Regras de Circulação", 
                              "Velocidade", "Prioridades", "Ultrapassagem", "Manobras", 
                              "Estacionamento", "Sinalização", "Iluminação", "Condutor"];
            
            const container = document.getElementById('categorySelector');
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'category-btn';
                button.textContent = category;
                button.dataset.category = category;
                
                if (category === "Todas") {
                    button.classList.add('active');
                }
                
                button.addEventListener('click', function() {
                    document.querySelectorAll('#categorySelector .category-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    gameState.quiz.currentCategory = category;
                    filterQuizQuestions(category);
                    gameState.quiz.currentQuestion = 0;
                    updateQuizUI();
                });
                
                container.appendChild(button);
            });
            
            filterQuizQuestions("Todas");
        }

        function filterQuizQuestions(category) {
            if (category === "Todas") {
                gameState.quiz.questions = [...allQuestions];
            } else {
                gameState.quiz.questions = allQuestions.filter(q => q.category === category);
            }
            document.getElementById('quizTotalQuestions').textContent = gameState.quiz.questions.length;
        }

        function startQuiz() {
            gameState.quiz.currentQuestion = 0;
            gameState.quiz.score = 0;
            updateQuizUI();
        }

        function updateQuizUI() {
            if (gameState.quiz.questions.length === 0) {
                document.getElementById('quizQuestion').textContent = "Nenhuma questão disponível para esta categoria.";
                document.getElementById('quizOptions').innerHTML = '';
                document.getElementById('quizSubmit').disabled = true;
                document.getElementById('quizNext').style.display = 'none';
                return;
            }
            
            const quiz = gameState.quiz;
            const currentQ = quiz.questions[quiz.currentQuestion];
            
            document.getElementById('quizQuestion').textContent = `Pergunta ${currentQ.id}: ${currentQ.question}`;
            document.getElementById('quizQuestionNum').textContent = quiz.currentQuestion + 1;
            document.getElementById('quizScore').textContent = quiz.score;
            
            const optionsContainer = document.getElementById('quizOptions');
            optionsContainer.innerHTML = '';
            
            currentQ.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.dataset.option = String.fromCharCode(65 + index);
                
                const letterSpan = document.createElement('span');
                letterSpan.className = 'option-letter';
                letterSpan.textContent = String.fromCharCode(65 + index);
                
                const textSpan = document.createElement('span');
                textSpan.textContent = option;
                
                optionElement.appendChild(letterSpan);
                optionElement.appendChild(textSpan);
                
                optionElement.addEventListener('click', function() {
                    document.querySelectorAll('#quizOptions .quiz-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    gameState.selectedOption = this.dataset.option;
                    document.getElementById('quizSubmit').disabled = false;
                });
                
                optionsContainer.appendChild(optionElement);
            });
            
            document.getElementById('quizSubmit').disabled = true;
            document.getElementById('quizSubmit').style.display = 'block';
            document.getElementById('quizNext').style.display = 'none';
            document.getElementById('quizResult').className = 'result-message';
            document.getElementById('quizResult').textContent = '';
        }

        function submitQuizAnswer() {
            const quiz = gameState.quiz;
            const currentQ = quiz.questions[quiz.currentQuestion];
            const options = document.querySelectorAll('#quizOptions .quiz-option');
            const resultMessage = document.getElementById('quizResult');
            
            const correctIndex = currentQ.correct;
            const selectedIndex = gameState.selectedOption.charCodeAt(0) - 65;
            
            if (selectedIndex === correctIndex) {
                quiz.score += 10;
                options[selectedIndex].classList.add('correct');
                resultMessage.textContent = "✓ Resposta correta!";
                resultMessage.className = 'result-message success';
            } else {
                options[selectedIndex].classList.add('wrong');
                options[correctIndex].classList.add('correct');
                resultMessage.textContent = `✗ Resposta incorreta.`;
                resultMessage.className = 'result-message error';
            }
            
            document.getElementById('quizScore').textContent = quiz.score;
            document.getElementById('quizSubmit').style.display = 'none';
            document.getElementById('quizNext').style.display = 'block';
        }

        function nextQuizQuestion() {
            gameState.quiz.currentQuestion++;
            
            if (gameState.quiz.currentQuestion < gameState.quiz.questions.length) {
                updateQuizUI();
            } else {
                // Fim do quiz
                gameState.progress.quizCompleted = true;
                updateProgress();
                
                document.getElementById('quizQuestion').textContent = "Categoria concluída!";
                document.getElementById('quizQuestionNum').textContent = gameState.quiz.questions.length;
                
                const optionsContainer = document.getElementById('quizOptions');
                optionsContainer.innerHTML = `
                    <div style="text-align: center; padding: 30px;">
                        <h3 style="color: #1e3c72; margin-bottom: 15px;">Resultado</h3>
                        <p style="font-size: 1.2rem; margin-bottom: 10px;">Acertos: <strong>${gameState.quiz.score / 10} de ${gameState.quiz.questions.length}</strong></p>
                        <p style="font-size: 1.2rem; margin-bottom: 10px;">Pontuação: <strong>${gameState.quiz.score} pontos</strong></p>
                        <p style="font-size: 1.1rem; color: #4CAF50;">
                            ${(gameState.quiz.score / 10) >= (gameState.quiz.questions.length * 0.7) ? "🎉 Bom trabalho!" : "📚 Continue estudando!"}
                        </p>
                    </div>
                `;
                
                document.getElementById('quizSubmit').style.display = 'none';
                document.getElementById('quizNext').style.display = 'none';
            }
        }

        function showQuizExplanation() {
            const quiz = gameState.quiz;
            const currentQ = quiz.questions[quiz.currentQuestion];
            const resultMessage = document.getElementById('quizResult');
            
            resultMessage.textContent = `💡 ${currentQ.explanation}`;
            resultMessage.className = 'result-message info';
        }

        // ==============================
        // MÓDULO: RECONHECIMENTO DE SINAIS
        // ==============================
        function initSignals() {
            // Configurar controles
            document.getElementById('signalSubmit').addEventListener('click', submitSignalAnswer);
            document.getElementById('signalNext').addEventListener('click', nextSignal);
            
            // Inicializar categorias de sinais
            const categories = ["Todos", "Perigo", "Proibição", "Obrigação", "Indicação"];
            const container = document.getElementById('signalCategorySelector');
            
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'signal-category-btn';
                button.textContent = category;
                button.dataset.category = category;
                
                if (category === "Todos") {
                    button.classList.add('active');
                }
                
                button.addEventListener('click', function() {
                    document.querySelectorAll('#signalCategorySelector .signal-category-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    gameState.signals.currentCategory = category;
                    filterSignalsByCategory(category);
                    gameState.signals.currentSignal = 0;
                    updateSignalsUI();
                });
                
                container.appendChild(button);
            });
            
            filterSignalsByCategory("Todos");
        }

        function filterSignalsByCategory(category) {
            if (category === "Todos") {
                gameState.signals.signs = [];
                for (const cat in trafficSigns) {
                    gameState.signals.signs = gameState.signals.signs.concat(trafficSigns[cat]);
                }
            } else {
                gameState.signals.signs = trafficSigns[category] || [];
            }
            document.getElementById('signalsTotal').textContent = gameState.signals.signs.length;
        }

        function startSignals() {
            gameState.signals.currentSignal = 0;
            gameState.signals.score = 0;
            updateSignalsUI();
        }

        function updateSignalsUI() {
            if (gameState.signals.signs.length === 0) {
                document.getElementById('signalQuestion').textContent = "Nenhum sinal disponível para esta categoria.";
                document.getElementById('signalOptions').innerHTML = '';
                document.getElementById('signalSubmit').disabled = true;
                document.getElementById('signalNext').style.display = 'none';
                return;
            }
            
            const signals = gameState.signals;
            const currentS = signals.signs[signals.currentSignal];
            
            const signalDisplay = document.getElementById('signalDisplay');
            signalDisplay.innerHTML = `<i class="${currentS.icon}"></i>`;
            signalDisplay.style.color = currentS.color;
            
            document.getElementById('signalQuestion').textContent = currentS.question;
            document.getElementById('signalNum').textContent = signals.currentSignal + 1;
            document.getElementById('signalsScore').textContent = signals.score;
            
            const optionsContainer = document.getElementById('signalOptions');
            optionsContainer.innerHTML = '';
            
            currentS.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'signal-option';
                optionElement.dataset.option = String.fromCharCode(65 + index);
                optionElement.textContent = option;
                
                optionElement.addEventListener('click', function() {
                    document.querySelectorAll('#signalOptions .signal-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    gameState.selectedOption = this.dataset.option;
                    document.getElementById('signalSubmit').disabled = false;
                });
                
                optionsContainer.appendChild(optionElement);
            });
            
            document.getElementById('signalSubmit').disabled = true;
            document.getElementById('signalSubmit').style.display = 'block';
            document.getElementById('signalNext').style.display = 'none';
            document.getElementById('signalResult').className = 'result-message';
            document.getElementById('signalResult').textContent = '';
        }

        function submitSignalAnswer() {
            const signals = gameState.signals;
            const currentS = signals.signs[signals.currentSignal];
            const options = document.querySelectorAll('#signalOptions .signal-option');
            const resultMessage = document.getElementById('signalResult');
            
            const correctIndex = currentS.correct;
            const selectedIndex = gameState.selectedOption.charCodeAt(0) - 65;
            
            if (selectedIndex === correctIndex) {
                signals.score++;
                options[selectedIndex].classList.add('correct');
                resultMessage.textContent = `✓ Correto! ${currentS.explanation}`;
                resultMessage.className = 'result-message success';
            } else {
                options[selectedIndex].classList.add('wrong');
                options[correctIndex].classList.add('correct');
                resultMessage.textContent = `✗ Incorreto. ${currentS.explanation}`;
                resultMessage.className = 'result-message error';
            }
            
            document.getElementById('signalsScore').textContent = signals.score;
            document.getElementById('signalSubmit').style.display = 'none';
            document.getElementById('signalNext').style.display = 'block';
        }

        function nextSignal() {
            gameState.signals.currentSignal++;
            
            if (gameState.signals.currentSignal < gameState.signals.signs.length) {
                updateSignalsUI();
            } else {
                // Fim do treino de sinais
                gameState.progress.signalsCompleted = true;
                updateProgress();
                
                document.getElementById('signalQuestion').textContent = "Treino de sinais concluído!";
                document.getElementById('signalNum').textContent = gameState.signals.signs.length;
                
                const signalDisplay = document.getElementById('signalDisplay');
                signalDisplay.innerHTML = '<i class="fas fa-flag-checkered"></i>';
                signalDisplay.style.color = '#4CAF50';
                
                const optionsContainer = document.getElementById('signalOptions');
                optionsContainer.innerHTML = `
                    <div style="text-align: center; padding: 20px; grid-column: 1 / -1;">
                        <h3 style="color: #1e3c72; margin-bottom: 15px;">Resultado Final</h3>
                        <p style="font-size: 1.2rem; margin-bottom: 10px;">Você acertou <strong>${gameState.signals.score} de ${gameState.signals.signs.length} sinais</strong></p>
                        <p style="font-size: 1.1rem; color: ${gameState.signals.score >= gameState.signals.signs.length * 0.7 ? '#4CAF50' : '#f44336'}">
                            ${gameState.signals.score >= gameState.signals.signs.length * 0.7 ? "🏆 Excelente!" : "📘 Continue praticando!"}
                        </p>
                    </div>
                `;
                
                document.getElementById('signalSubmit').style.display = 'none';
                document.getElementById('signalNext').style.display = 'none';
            }
        }

        // ==============================
        // MÓDULO: ESTACIONAMENTO
        // ==============================
        function initParking() {
            // Configurar controles
            document.getElementById('carLeft').addEventListener('click', () => moveCar('left'));
            document.getElementById('carRight').addEventListener('click', () => moveCar('right'));
            document.getElementById('carUp').addEventListener('click', () => moveCar('up'));
            document.getElementById('carDown').addEventListener('click', () => moveCar('down'));
            document.getElementById('carRotate').addEventListener('click', rotateCar);
            document.getElementById('parkCar').addEventListener('click', checkParking);
            document.getElementById('resetParking').addEventListener('click', resetParking);
            document.getElementById('parkingHint').addEventListener('click', showParkingHint);
        }

        function startParking() {
            const parkingArea = document.getElementById('parkingArea');
            parkingArea.innerHTML = '';
            
            // Criar carro
            const car = document.createElement('div');
            car.id = 'car';
            car.className = 'car';
            car.textContent = 'C';
            car.style.top = '50px';
            car.style.left = '50px';
            car.style.transform = 'rotate(0deg)';
            parkingArea.appendChild(car);
            
            // Criar vagas de estacionamento
            const parkingSpot1 = document.createElement('div');
            parkingSpot1.className = 'parking-spot';
            parkingSpot1.id = 'parkingSpot1';
            parkingSpot1.style.width = '80px';
            parkingSpot1.style.height = '120px';
            parkingSpot1.style.top = '200px';
            parkingSpot1.style.left = '300px';
            parkingArea.appendChild(parkingSpot1);
            
            const parkingSpot2 = document.createElement('div');
            parkingSpot2.className = 'parking-spot';
            parkingSpot2.style.width = '80px';
            parkingSpot2.style.height = '120px';
            parkingSpot2.style.top = '200px';
            parkingSpot2.style.left = '400px';
            parkingArea.appendChild(parkingSpot2);
            
            const parkingSpot3 = document.createElement('div');
            parkingSpot3.className = 'parking-spot';
            parkingSpot3.style.width = '80px';
            parkingSpot3.style.height = '120px';
            parkingSpot3.style.top = '200px';
            parkingSpot3.style.left = '500px';
            parkingArea.appendChild(parkingSpot3);
            
            // Resetar variáveis
            gameState.parking.moves = 0;
            gameState.parking.carRotation = 0;
            gameState.parking.carPosition = { x: 50, y: 50 };
            
            document.getElementById('parkingMoves').textContent = '0';
            document.getElementById('parkingResult').className = 'result-message';
            document.getElementById('parkingResult').textContent = '';
            
            // Definir vaga alvo (a primeira)
            window.targetParkingSpot = parkingSpot1;
        }

        function moveCar(direction) {
            const car = document.getElementById('car');
            let newX = gameState.parking.carPosition.x;
            let newY = gameState.parking.carPosition.y;
            
            switch(direction) {
                case 'left':
                    newX = Math.max(10, gameState.parking.carPosition.x - 10);
                    break;
                case 'right':
                    newX = Math.min(730, gameState.parking.carPosition.x + 10);
                    break;
                case 'up':
                    newY = Math.max(10, gameState.parking.carPosition.y - 10);
                    break;
                case 'down':
                    newY = Math.min(280, gameState.parking.carPosition.y + 10);
                    break;
            }
            
            gameState.parking.carPosition.x = newX;
            gameState.parking.carPosition.y = newY;
            
            car.style.left = `${newX}px`;
            car.style.top = `${newY}px`;
            
            gameState.parking.moves++;
            document.getElementById('parkingMoves').textContent = gameState.parking.moves;
        }

        function rotateCar() {
            const car = document.getElementById('car');
            gameState.parking.carRotation = (gameState.parking.carRotation + 90) % 360;
            car.style.transform = `rotate(${gameState.parking.carRotation}deg)`;
            
            gameState.parking.moves++;
            document.getElementById('parkingMoves').textContent = gameState.parking.moves;
        }

        function checkParking() {
            const car = document.getElementById('car');
            const targetSpot = window.targetParkingSpot;
            const resultMessage = document.getElementById('parkingResult');
            
            const carRect = {
                left: gameState.parking.carPosition.x,
                top: gameState.parking.carPosition.y,
                right: gameState.parking.carPosition.x + 60,
                bottom: gameState.parking.carPosition.y + 100
            };
            
            const spotRect = {
                left: parseInt(targetSpot.style.left),
                top: parseInt(targetSpot.style.top),
                right: parseInt(targetSpot.style.left) + 80,
                bottom: parseInt(targetSpot.style.top) + 120
            };
            
            // Verificar se o carro está dentro da vaga
            const isInSpot = 
                carRect.left >= spotRect.left &&
                carRect.right <= spotRect.right &&
                carRect.top >= spotRect.top &&
                carRect.bottom <= spotRect.bottom;
            
            // Verificar se o carro está alinhado (ângulo correto)
            const isAligned = gameState.parking.carRotation === 0 || gameState.parking.carRotation === 180;
            
            if (isInSpot && isAligned) {
                resultMessage.textContent = "🎉 Parabéns! Você estacionou perfeitamente!";
                resultMessage.className = 'result-message success';
                gameState.progress.parkingCompleted = true;
                updateProgress();
            } else if (isInSpot && !isAligned) {
                resultMessage.textContent = "Quase lá! O carro está na vaga, mas não está alinhado corretamente. Tente girar o carro para 0° ou 180°.";
                resultMessage.className = 'result-message error';
            } else {
                resultMessage.textContent = "Tente novamente! O carro não está dentro da vaga de estacionamento.";
                resultMessage.className = 'result-message error';
            }
        }

        function resetParking() {
            startParking();
        }

        function showParkingHint() {
            const resultMessage = document.getElementById('parkingResult');
            resultMessage.textContent = "💡 Dica: Use as setas para mover o carro lentamente até a vaga tracejada à direita. Use o botão 'Girar' para alinhar o carro com a vaga (0° ou 180°). O objetivo é colocar o carro completamente dentro da área tracejada.";
            resultMessage.className = 'result-message info';
        }

        // ==============================
        // MÓDULO: PRIORIDADES NO TRÂNSITO
        // ==============================
        function initPriority() {
            document.getElementById('prioritySubmit').addEventListener('click', submitPriorityAnswer);
            document.getElementById('priorityNext').addEventListener('click', nextPriorityScenario);
            document.getElementById('priorityTotal').textContent = priorityScenarios.length;
        }

        function startPriority() {
            gameState.priority.currentScenario = 0;
            gameState.priority.score = 0;
            updatePriorityUI();
        }

        function updatePriorityUI() {
            const priority = gameState.priority;
            const currentS = priority.scenarios[priority.currentScenario];
            
            document.getElementById('priorityScenario').innerHTML = `
                <h3 style="color: #1e3c72; margin-bottom: 10px;">${currentS.scenario}</h3>
                <p style="color: #666; margin-bottom: 15px;">${currentS.description}</p>
            `;
            
            document.getElementById('priorityQuestion').textContent = currentS.question;
            document.getElementById('priorityNum').textContent = priority.currentScenario + 1;
            document.getElementById('priorityScore').textContent = priority.score;
            
            const optionsContainer = document.getElementById('priorityOptions');
            optionsContainer.innerHTML = '';
            
            currentS.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.dataset.option = String.fromCharCode(65 + index);
                
                const letterSpan = document.createElement('span');
                letterSpan.className = 'option-letter';
                letterSpan.textContent = String.fromCharCode(65 + index);
                
                const textSpan = document.createElement('span');
                textSpan.textContent = option;
                
                optionElement.appendChild(letterSpan);
                optionElement.appendChild(textSpan);
                
                optionElement.addEventListener('click', function() {
                    document.querySelectorAll('#priorityOptions .quiz-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    gameState.selectedOption = this.dataset.option;
                    document.getElementById('prioritySubmit').disabled = false;
                });
                
                optionsContainer.appendChild(optionElement);
            });
            
            document.getElementById('prioritySubmit').disabled = true;
            document.getElementById('prioritySubmit').style.display = 'block';
            document.getElementById('priorityNext').style.display = 'none';
            document.getElementById('priorityResult').className = 'result-message';
            document.getElementById('priorityResult').textContent = '';
        }

        function submitPriorityAnswer() {
            const priority = gameState.priority;
            const currentS = priority.scenarios[priority.currentScenario];
            const options = document.querySelectorAll('#priorityOptions .quiz-option');
            const resultMessage = document.getElementById('priorityResult');
            
            const correctIndex = currentS.correct;
            const selectedIndex = gameState.selectedOption.charCodeAt(0) - 65;
            
            if (selectedIndex === correctIndex) {
                priority.score += 20;
                options[selectedIndex].classList.add('correct');
                resultMessage.textContent = "✓ Correto! " + currentS.explanation;
                resultMessage.className = 'result-message success';
            } else {
                options[selectedIndex].classList.add('wrong');
                options[correctIndex].classList.add('correct');
                resultMessage.textContent = `✗ Incorreto. ` + currentS.explanation;
                resultMessage.className = 'result-message error';
            }
            
            document.getElementById('priorityScore').textContent = priority.score;
            document.getElementById('prioritySubmit').style.display = 'none';
            document.getElementById('priorityNext').style.display = 'block';
        }

        function nextPriorityScenario() {
            gameState.priority.currentScenario++;
            
            if (gameState.priority.currentScenario < gameState.priority.scenarios.length) {
                updatePriorityUI();
            } else {
                // Fim do treino de prioridades
                gameState.progress.priorityCompleted = true;
                updateProgress();
                
                document.getElementById('priorityQuestion').textContent = "Treino de prioridades concluído!";
                document.getElementById('priorityNum').textContent = gameState.priority.scenarios.length;
                
                const scenarioDiv = document.getElementById('priorityScenario');
                scenarioDiv.innerHTML = `
                    <h3 style="color: #1e3c72; margin-bottom: 10px;">Treino Concluído!</h3>
                    <p style="color: #666; margin-bottom: 15px;">Você completou todos os cenários de prioridade.</p>
                `;
                
                const optionsContainer = document.getElementById('priorityOptions');
                optionsContainer.innerHTML = `
                    <div style="text-align: center; padding: 30px;">
                        <h3 style="color: #1e3c72; margin-bottom: 15px;">Resultado Final</h3>
                        <p style="font-size: 1.2rem; margin-bottom: 10px;">Sua pontuação: <strong>${gameState.priority.score} de ${gameState.priority.scenarios.length * 20} pontos</strong></p>
                        <p style="font-size: 1.1rem; color: ${gameState.priority.score >= (gameState.priority.scenarios.length * 20 * 0.7) ? '#4CAF50' : '#f44336'}">
                            ${gameState.priority.score >= (gameState.priority.scenarios.length * 20 * 0.7) ? "🚦 Excelente! Você domina as regras de prioridade!" : "📖 Continue praticando para entender melhor as prioridades!"}
                        </p>
                    </div>
                `;
                
                document.getElementById('prioritySubmit').style.display = 'none';
                document.getElementById('priorityNext').style.display = 'none';
            }
        }

        // ==============================
        // INICIAR O JOGO
        // ==============================
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
